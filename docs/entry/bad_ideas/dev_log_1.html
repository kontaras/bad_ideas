<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Bad Ideas Dev Log, Part 1: Getting Started</title>
        <link rel="stylesheet" href="https://kontaras.github.io/bad_ideas//styles/style.css">
    </head>
    <body>
        <h1>Bad Ideas Dev Log, Part 1: Getting Started</h1>
        <div id="contents">
            <p class="dateline">2022-10-15 (Updated 2023-09-03)</p>
<div id="tags">Tags: <a href="https://kontaras.github.io/bad_ideas/tag/bad_ideas.html">bad_ideas</a>, <a href="https://kontaras.github.io/bad_ideas/tag/dev_log.html">dev_log</a></div>
	<h2>Motivations</h2>

	<p>I have wanted to play around with using GitHub actions to gerate static web sites for quite a while, but never had a good place for it.
 Starting a blog, even if I don&#8217;t think I will be adding regular content, offers me a chance to satiate my curiosity.</p>

	<h3>Why did I choose Textile?</h3>

	<p>I wanted to use a markup language to what I would not be writing a lot of raw <span class="caps">HTML</span>.
 Since I wanted to write the project in Python, there would have to be a Python library available for it.
 Markdown was the obvious choice, but I am already using it for my <a href="https://github.com/kontaras/LabBook">LabBook</a>.
 Looking around, I came across a few and <a href="https://textile-lang.com/">Textile</a> looked like a good candidate.
 I noticed that it had a very desirable feature: <a href="https://textile-lang.com/doc/textile-comments">comments</a>.
 I planned to make use of comments to inject metadata into the files without having to strip it out before passing them into the engine.</p>

	<h2>The first prototype</h2>

	<h3>Generating files</h3>

	<p><a href="https://github.com/kontaras/bad_ideas/blob/8bed11ac577173293946aa133e1d5c214a8c2b4b/main.py">Full code</a></p>

	<p>To render all of the pages, I needed to iterate over all of the pages and run them through the renderer:</p>

<pre><code>for root, _, files in os.walk(inFolder):
   relRoot = os.path.relpath(root, inFolder)
   for fileName in files:
      inPath = os.path.join(root, fileName)
      inFileRoot, _ = os.path.splitext(fileName)
      outPath = os.path.join(outFolder, relRoot, inFileRoot) + outFileExt
      render(inPath, outPath)</code></pre>

	<p>For now, the renderer is just running the files through a textile.
 In the future, it can be expanded to inject more content into pages:</p>

<pre><code>def render(inFile, outFile):
   with open(inFile, &quot;r&quot;) as inStream, open(outFile, &quot;w&quot;) as outStream:
      outStream.write(textile.textile(inStream.read()))</code></pre>

	<h3>Building and deploying a sites</h3>

	<p><a href="https://github.com/kontaras/bad_ideas/blob/238a3045fdd0559d584136a9252fef8694151d74/.github/workflows/generate_pages.yml">Full code</a></p>

	<p>With most of the logic already in the generation script, the publishing script is simply plumbing to take the right files in an put them in the right place.</p>

	<p>The script is run on each commit to the main branch:</p>

<pre><code>on:
  # Triggers the workflow on push or pull request events but only for the main branch
  push:
    branches: [ main ]</code></pre>

	<p>It then pulls the files from git:</p>

<pre><code>- uses: actions/checkout@v2
with:
   persist-credentials: false # otherwise, the token used is the GITHUB_TOKEN, instead of your personal token
   fetch-depth: 0 # otherwise, you will failed to push refs to dest repo</code></pre>

	<p>And runs them through the render script:</p>

<pre><code>run: |
   python -m pip install -r requirements.txt
   python main.py</code></pre>

	<p>Finally, the pages are checked into a new branch, <code>github_pages</code>:</p>

<pre><code>- name: Commit files
run: |
   git config --local user.email &quot;41898282+github-actions[bot]@users.noreply.github.com&quot;
   git config --local user.name &quot;github-actions[bot]&quot;
   git add -f docs
   git commit -m &quot;Rendered new pages&quot; -a
- name: Push changes
uses: ad-m/github-push-action@master
with:
   github_token: ${{ secrets.GITHUB_TOKEN }}
   branch: github_pages
   force: true</code></pre>

	<p>That branch is configured to be publicly viewable using Github Pages:</p>

	<p><a href="../../media/bad_ideas/dev_log_1/github_pages.png"><img alt="GitHub Pages configuration" src="../../media/bad_ideas/dev_log_1/github_pages.png" style="width: 100%;" title="GitHub Pages configuration" /></a></p>

        </div>
    </body>
</html>
